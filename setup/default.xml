<?xml version='1.0' encoding='UTF-8'?>

<!DOCTYPE properties SYSTEM 'http://java.sun.com/dtd/properties.dtd'>

<properties>

    <!-- SERVER CONFIG -->

    <entry key='web.origin'>*</entry>
    <entry key='web.enable'>true</entry>
    <entry key='web.port'>8082</entry>
    <entry key='web.path'>./web</entry>
    <entry key='web.cacheControl'>max-age=3600,public</entry>

    <entry key='geocoder.enable'>true</entry>
    <entry key='geocoder.type'>google</entry>

    <entry key='logger.enable'>true</entry>
    <entry key='logger.level'>all</entry>
    <entry key='logger.file'>./logs/tracker-server.log</entry>

    <entry key='filter.enable'>true</entry>
    <entry key='filter.future'>3600</entry>

    <entry key='event.enable'>true</entry>
    <entry key='event.ignoreDuplicateAlerts'>true</entry>
    <entry key='processing.computedAttributes.enable'>true</entry>

    <entry key='media.path'>./media</entry>

    <entry key='server.statistics'>https://www.traccar.org/analytics/</entry>

    <entry key='commands.queueing'>true</entry>

    <!-- DATABASE CONFIG -->

    <entry key='database.ignoreUnknown'>true</entry>

    <entry key='database.generateQueries'>true</entry>

    <entry key='database.changelog'>./schema/changelog-master.xml</entry>
 
    <entry key='database.loginUser'>
        SELECT * FROM users
        WHERE email = :email OR login = :email
    </entry>

    <entry key='database.selectPositions'>
        SELECT * FROM positions WHERE deviceId = :deviceId AND fixTime BETWEEN :from AND :to ORDER BY fixTime
    </entry>

    <entry key='database.selectPositionsForRoute'>
        SELECT deviceid, devicetime, latitude, longitude, speed, course, attributes
        FROM positions
        WHERE deviceId = :deviceId
        AND fixTime BETWEEN :from AND :to
        AND mod(minute(fixTime),:timerange) = 0
        AND valid = true
        ORDER BY fixTime
    </entry>

    <entry key='database.selectPositionsForFuel'>
        SELECT deviceid, devicetime, attributes
        FROM positions
        WHERE deviceId = :deviceId
        AND fixTime BETWEEN :from AND :to
        ORDER BY fixTime
    </entry>

    <entry key='database.selectPeripheralSensors'>
        SELECT p.id AS peripheralSensorId, d.id AS deviceId, dt.typename as typeName, p.calibrationdata as calibrationData
        FROM peripheralsensors AS p
        JOIN peripheralsensortypes AS dt ON p.sensortypeid = dt.id
        JOIN device_peripheralsensors AS dp ON p.id = dp.peripheralsensorid
        JOIN devices AS d ON dp.deviceid = d.id;
    </entry>

    <entry key='database.selectFCMPushNotificationsByUserId'>
        SELECT deviceId, eventTypeId, enabled FROM fcmpushnotifications WHERE userId = :userId
    </entry>

    <entry key="database.insertFCMPushNotification">
        INSERT INTO fcmPushNotifications(deviceId, userId, eventTypeId, enabled)
        VALUES (:deviceId, :userId, :eventTypeId, :enabled)
        ON DUPLICATE KEY UPDATE enabled = :enabled
    </entry>

    <entry key="database.insertFCMUserToken">
        INSERT INTO FCMUserTokens(userId, clientToken)
        VALUES (:userId, :clientToken)
        ON DUPLICATE KEY UPDATE clientToken = :clientToken
    </entry>

    <entry key='database.selectLatestPositions'>
        SELECT positions.* FROM positions INNER JOIN devices ON positions.id = devices.positionid;
    </entry>

    <entry key='database.updateLatestPosition'>
        UPDATE devices SET positionId = :id WHERE id = :deviceId
    </entry>

    <entry key='database.selectEvents'>
        SELECT * FROM events WHERE deviceId = :deviceId AND serverTime BETWEEN :from AND :to ORDER BY serverTime
    </entry>

    <entry key='database.deletePositions'>
        DELETE FROM positions WHERE serverTime &lt; :serverTime AND id NOT IN (SELECT positionId FROM devices WHERE positionId IS NOT NULL)
    </entry>

    <entry key='database.deleteEvents'>
        DELETE FROM events WHERE serverTime &lt; :serverTime
    </entry>

    <entry key='database.selectStatistics'>
        SELECT * FROM statistics WHERE captureTime BETWEEN :from AND :to ORDER BY captureTime
    </entry>
</properties>
