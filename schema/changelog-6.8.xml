<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd"
  logicalFilePath="changelog-6.8">

  <property name="tc_converted_positions.platform" value="AutoNavi,Baidu,Tencent" />
  <property name="tc_converted_positions.crs" value="GCJ_02,BD_09" />

  <changeSet author="author" id="changelog-6.8">

    <createTable tableName="tc_converted_positions">
      <column name="id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="platform" type="VARCHAR(16)">
        <constraints nullable="false" checkConstraint="${tc_converted_positions.platform}" />
      </column>
      <column name="crs" type="VARCHAR(10)">
        <constraints nullable="false" checkConstraint="${tc_converted_positions.crs}" />
      </column>
      <column name="latitude" type="DOUBLE">
        <constraints nullable="false" />
      </column>
      <column name="longitude" type="DOUBLE">
        <constraints nullable="false" />
      </column>

      <column name="attributes" type="VARCHAR(4000)">
        <constraints nullable="false" />
      </column>
    </createTable>

    <addPrimaryKey tableName="tc_converted_positions" columnNames="id, platform" />

    <addForeignKeyConstraint baseTableName="tc_converted_positions" baseColumnNames="id" constraintName="fk_position_id" referencedTableName="tc_positions" referencedColumnNames="id" onDelete="CASCADE" onUpdate="NO ACTION" />

    <createIndex tableName="tc_converted_positions" indexName="idx_tc_converted_positions_crs">
      <column name="platform" />
      <column name="crs" />
    </createIndex>
    <createIndex tableName="tc_positions" indexName="idx_tc_positions_latitude_longitude">
      <column name="latitude" />
      <column name="longitude" />
    </createIndex>
  </changeSet>

</databaseChangeLog>
